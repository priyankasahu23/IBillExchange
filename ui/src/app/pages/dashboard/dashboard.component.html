<div class="dashboard-container">
  <img src="assets/Lloyds_Banking_Group_logo.png" alt="Logo" class="small-logo" />
  <!--<div *ngIf="userRole === 'Admin'">
    <h1>Welcome, Admin</h1>
    <p>This is the Admin Dashboard where you can manage users and payments.</p>
  </div>-->

  <div *ngIf="userRole === 'Seller'" class="dashboard">
    <!-- Header -->
    <h1 class="title">Welcome, Global Exports!</h1>

    <!-- Add Product Button -->
    <button class="add-button" (click)="openForm()">â• Create New Transaction Request</button>

    <!-- Modal Form -->
    <div *ngIf="isFormOpen" class="modal">
        <div class="modal-content">
            <h2>Enter Transaction Details</h2>

            <!-- Amount input -->
            <label for="amount">ğŸ’° Amount :</label>
            <input id="amount" [(ngModel)]="transactionDetails.amount" type="number" placeholder="Enter amount" />

            <label>ğŸ’° Product Type:
                <select [(ngModel)]="transactionDetails.billType"  (change)="onProductTypeChange($event)">
                    <option *ngFor="let billType of billTypeList" [value]="billType">{{ billType }}</option>
                </select>
            </label>

            <label *ngIf="transactionDetails.billType === 'Documentary Collection'">Sub Type:
              <select [(ngModel)]="selectedSubType">
                  <option *ngFor="let subType of subTypes" [value]="subType">{{ subType }}</option>
              </select>
          </label>
            <label>ğŸ’± Currency:
                <select [(ngModel)]="transactionDetails.currency">
                    <option *ngFor="let currency of currencyList" [value]="currency">{{ currency }}</option>
                </select>
            </label>
            <!-- Seller Details -->
            <fieldset>
                <legend>Seller Bank</legend>
                <label>ğŸ¢ Company Name:
                    <select [(ngModel)]="transactionDetails.sellerCN" (change)="updateDetails('seller')">
                        <option *ngFor="let item of sellerList" [value]="item.cn">{{ item.cn }}</option>
                    </select>
                </label>
                <label>ğŸ’¼ Organisation: <input [(ngModel)]="transactionDetails.sellerO"></label>
                <label>ğŸ“ Location: <input [(ngModel)]="transactionDetails.sellerL"></label>
                <label>ğŸŒ Country: <input [(ngModel)]="transactionDetails.sellerC"></label>
            </fieldset>

            <!-- Buyer Bank Details -->
            <fieldset>
                <legend>Buyer Bank Details</legend>
                <label>ğŸ¢ Company Name:
                    <select [(ngModel)]="transactionDetails.buyerBankCN" (change)="updateDetails('buyerBank')">
                        <option *ngFor="let item of cnList" [value]="item.cn">{{ item.cn }}</option>
                    </select>
                </label>
                <label>ğŸ’¼ Organization: <input [(ngModel)]="transactionDetails.buyerBankO"></label>
                <label>ğŸ“ Location: <input [(ngModel)]="transactionDetails.buyerBankL"></label>
                <label>ğŸŒ Country: <input [(ngModel)]="transactionDetails.buyerBankC"></label>
            </fieldset>

            <!-- Buyer Details -->
            <fieldset>
                <legend>Buyer Details</legend>
                <label>ğŸ¢ Company Name:
                    <select [(ngModel)]="transactionDetails.buyerCN" (change)="updateDetails('buyer')">
                        <option *ngFor="let item of cnList" [value]="item.cn">{{ item.cn }}</option>
                    </select>
                </label>
                <label>ğŸ’¼ Organization: <input [(ngModel)]="transactionDetails.buyerO"></label>
                <label>ğŸ“ Location: <input [(ngModel)]="transactionDetails.buyerL"></label>
                <label>ğŸŒ Country: <input [(ngModel)]="transactionDetails.buyerC"></label>
            </fieldset>

            <!-- Issuance Date and Due Date -->
            <fieldset>
                <legend>Transaction Dates</legend>
                <div class="date-row">
                    <label for="issuanceDate">ğŸ“… Issuance Date:</label>
                    <input id="issuanceDate" [(ngModel)]="transactionDetails.issuanceDate" type="text" placeholder="YYYY-MM-DD" />

                    <label for="dueDate">â³ Due Date:</label>
                    <input id="dueDate" [(ngModel)]="transactionDetails.dueDate" type="text" placeholder="YYYY-MM-DD" />
                </div>
            </fieldset>

            <label>âœ… Avalisation:</label>
            <input [(ngModel)]="transactionDetails.avalisation" type="text" placeholder="Yes or No"/>
            <!-- File Upload Section -->
            <fieldset>
              <legend>ğŸ“„ Upload Supporting Document</legend>
              <input type="file" (change)="handleFileUpload($event)" accept=".pdf, .jpg, .png, .docx" />
          </fieldset>

            <!-- Buttons -->
            <div class="modal-buttons">
                <button class="cancel-button" (click)="closeForm()">Cancel</button>
          <button
            class="submit-button"
            (click)="submitForm()">
<!--            [disabled]="!amount || amount <= 0 || !billType || billType.length < 3"-->
            Submit
          </button>
        </div>
      </div>
    </div>

    <!-- Data Grid -->
    <div class="grid-container">
        <ag-grid-angular
            class="ag-theme-alpine full-grid"
            [columnDefs]="columnDefs"
            [rowData]="rowData"
            [pagination]="true"
            (gridReady)="onGridReady($event)"
            [modules]="modules"
            rowSelection="single">
        </ag-grid-angular>
    </div>
  </div>

  <div *ngIf="userRole === 'Buyer'" class="dashboard">
    <h1 class="title">{{ userRole }} Dashboard</h1>
    <div class="grid-container">
      <ag-grid-angular
        class="ag-theme-alpine full-grid"
        [columnDefs]="columnDef_Buyer"
        [rowData]="rowData"
        [pagination]="true"
        (gridReady)="onGridReady($event)"
        (rowSelected)="onRowSelected($event)"
        [modules]="modules">
      </ag-grid-angular>
    </div>

    <!-- Popup for Approval -->
    <div class="popup" *ngIf="showPopup">
      <div class="popup-content">
        <h3>Transaction Summary</h3>
        <p><b>Amount:</b> {{ selectedTransaction?.amount }}</p>
        <p><b>Product Type:</b>Contract Document</p>
        <p><b>Currency:</b> {{ selectedTransaction?.currency }}</p>
        <p><b>Seller Name:</b> {{ selectedTransaction?.sellerName }}</p>
        <p><b>Buyer Bank Name:</b> {{ selectedTransaction?.buyerBankName }}</p>
        <p><b>Due Date:</b> {{ selectedTransaction?.dueDate }}</p>
        <p><b>Avalised:</b> Yes</p>

        <button class="green-btn" (click)="approveTransaction(selectedTransaction)">Approve</button>
        <button class="red-btn" (click)="updateTransaction('Rejected')">Reject</button>
        <button class="close-btn" (click)="closePopup()">Close</button>
      </div>
    </div>
  </div>
</div>